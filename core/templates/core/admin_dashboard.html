{% extends 'core/base.html' %}
{% block content %}
<h2>Admin Dashboard: Payment Analytics</h2>
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <h5 class="card-title">Users with Pending Payments</h5>
                <p class="card-text display-6">{{ summary.total_users_with_pending }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-dark">
            <div class="card-body">
                <h5 class="card-title">Pending Payments</h5>
                <p class="card-text display-6">{{ summary.total_pending_payments }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5 class="card-title">Total Collected</h5>
                <p class="card-text display-6">{{ summary.total_collected }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <h5 class="card-title">Total Remaining</h5>
                <p class="card-text display-6">{{ summary.total_remaining }}</p>
            </div>
        </div>
    </div>
</div>
<h3>Category-wise Stats</h3>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Category</th>
            <th>Pending Payments</th>
            <th>Users with Pending</th>
            <th>Collected</th>
            <th>Remaining</th>
        </tr>
    </thead>
    <tbody>
        {% for cat in summary.category_stats %}
        <tr>
            <td>{{ cat.category.name }}</td>
            <td>{{ cat.pending_count }}</td>
            <td>{{ cat.users_with_pending }}</td>
            <td>{{ cat.collected }}</td>
            <td>{{ cat.remaining }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<h3>Pending/Partial Payments</h3>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>User</th>
            <th>Category</th>
            <th>Service</th>
            <th>Due Amount</th>
            <th>Total Paid</th>
            <th>Remaining</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for entry in analytics %}
        <tr>
            <td>{{ entry.user.username }}</td>
            <td>{{ entry.category.name }}</td>
            <td>{{ entry.service.description }}</td>
            <td>{{ entry.due_amount }}</td>
            <td>{{ entry.total_paid }}</td>
            <td>{{ entry.remaining }}</td>
            <td>{{ entry.status }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="7">No pending or partial payments found.</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
